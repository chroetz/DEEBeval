---
title: "DEEB Evaluation -- Plots"
date: "`r format(Sys.Date())`"
output: 
  html_document:
    toc: no
    toc_depth: 6
    number_sections: no
    self_contained: false
params:
  plotsDir: "~/DEEBDB9/lotkaVolterra/plots"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(tidyverse.quiet = TRUE)
library(tidyverse)
```

```{r, include=FALSE}
pattern <- "Truth(\\d+)Obs(\\d+)Task(\\d+)(\\w+)_(\\w+)\\.png"
fileMatrix <- 
  params$plotsDir |> 
  dir() |> 
  str_subset(pattern) |> 
  str_match(pattern)
colnames(fileMatrix) <- c("fileName", "truthNr", "obsNr", "taskNr", "method", "kind")
plots <- 
  as_tibble(fileMatrix) |> 
  mutate(across(ends_with("Nr"), as.integer)) |> 
  mutate(path = normalizePath(file.path(params$plotsDir, .data$fileName), mustWork=TRUE))
```

# Plots  {.tabset}

```{r results='asis', fig.show='asis'}
for (tnr in unique(plots$taskNr)) {
  cat("## Task", tnr, " {.tabset}\n")
  taskPlots <- filter(plots, taskNr == tnr)
  for (onr in unique(taskPlots$obsNr)) {
    cat("### ObsNr", onr, " {.tabset}\n")
    obsPlots <- filter(taskPlots, obsNr == onr)
    for (knd in unique(obsPlots$kind)) {
      cat("#### Plots", knd, "\n\n")
      kindPlots <- filter(obsPlots, kind == knd)
      for (thnr in sort(unique(kindPlots$truthNr))) {
        truthPlots <- filter(kindPlots, truthNr == thnr)
        cat(paste(paste0("![](", truthPlots$path, "){width=",100/(length(truthPlots$path))-1,"%}"), collapse="\n"), "\n\n") 
      }
      cat("\n\n")
    }
  }
}
```


